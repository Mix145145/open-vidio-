# Tuposcan (Raspberry Pi 4B + IMX477)

Проект сканирует плоские объекты (например, плату) камерой на каретке 3D‑принтера.

## Новый режим сканирования (видео → плоские полосы)

Вместо классического feature-stitching «кадр к кадру» используется другой подход:

1. Для каждой X-полосы пишется видео прохода по Y (`raw/strip_XXX.mp4`).
2. Из каждого кадра берётся узкий вертикальный срез (`slice_width_px`) в стабильной зоне кадра.
3. Срезы собираются по времени в `strips/strip_XXX.png` (time → Y), что даёт «плоскую развёртку» без перспективного изгиба.
4. Готовые полосы сшиваются по X с перекрытием в `result/final.png`.

## Калибровка FOV

Вкладка **Настройки FOV**:
- выберите режим `2K`;
- откройте предпросмотр;
- введите `FOV X/Y (мм)`;
- нажмите **Сохранить FOV**.

Значения сохраняются в `config.json` и используются при расчёте полос.

## Сканирование

Вкладка **Сканирование**:
- профиль размеров (`width/height`, например 95×95);
- стартовая точка `X0/Y0`;
- `Overlap X (мм)`;
- параметры развёртки: `slice px`, `slice offset`, `FPS`, `Стабилизация X`.

Кнопки:
- **Scan** — старт,
- **Stop** — остановка текущего процесса,
- **Save** — сохранить финальное изображение.

## Структура результатов

Каждый запуск создаёт каталог `scans/<name>_<timestamp>/`:

- `raw/strip_000.mp4`, `raw/strip_001.mp4`, ...
- `strips/strip_000.png`, `strips/strip_001.png`, ...
- `result/final.png`
- `report.json` (параметры скана, шаги, FPS, файлы полос)

## Запуск

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python3 main.py
```
