# Tuposcan (Raspberry Pi 4B + IMX477)

Проект предназначен для работы на Raspberry Pi 4B с камерой Sony IMX477, подключенной через CSI, и 3D‑принтером, подключённым через USB‑серийный порт.

## Быстрый старт на «нулевой» Raspberry Pi

1. **Обновите систему и установите Python**:
   ```bash
   sudo apt update
   sudo apt install -y python3 python3-venv python3-pip
   ```

2. **Включите CSI‑камеру** (если ещё не включена):
   ```bash
   sudo raspi-config
   ```
   В меню выберите **Interface Options → Camera → Enable**, затем перезагрузите устройство.

3. **Склонируйте проект и создайте окружение**:
   ```bash
   git clone <URL-репозитория>
   cd tuposcan
   python3 -m venv .venv
   source .venv/bin/activate
   ```

4. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

5. **Запуск**:
   ```bash
   python3 main.py
   ```

> Для Raspberry Pi рекомендуется установить `picamera2` через `apt`, чтобы приложение могло
> получать кадры напрямую через libcamera (это помогает, когда `rpicam-hello` работает, а
> OpenCV не видит камеру).

## Настройки

- **Сериал порт**: приложение автоматически выбирает `/dev/ttyUSB0` (если доступен) и пробует подключиться при старте.
- **Камера**: по умолчанию выбирается `Camera 0: imx477` (или камера `0`, если точного имени нет).
- **FOV в «Настройки FOV»**: доступны режимы `FHD` (`1920x1080`), `2K` (`2560x1440`) и `4K` (`3840x2160`) с отдельным FOV (мм) для каждого разрешения.
- **FOV = Move**: галочка делает шаги сканирования равными FOV (stepX = fovX, stepY = fovY).
- **В центр на высоту**: отправляет принтер в центр стола (X54 Y110) на выбранную высоту Z для настройки FOV.
- **Вид с камеры**: предпросмотр камеры для оперативной настройки FOV/фокуса.
- **Склейка**: используется только MultiBand Blender.
- **LAN управление**: встроенный HTTP API запускается на `0.0.0.0:8765`.
  - `GET /status` — текущее состояние подключения.
  - `GET /gcode?cmd=G28` — отправка команды G-code.

Все настройки сохраняются в `aruco_calib.json` рядом с файлом проекта.

## Документация по camtest.py

Для проверки камеры и измерения FPS используйте `camtest.py`. Полная инструкция по запуску,
параметрам и чтению отчёта находится в отдельном документе: [CAMTEST.md](CAMTEST.md).
